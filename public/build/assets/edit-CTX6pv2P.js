import{c as z,u as $,b as P,j as t,F as V,H as A}from"./app-DdbnQ3su.js";import{S as H}from"./ShoppingListController-BjVYbz0_.js";import{I as j}from"./input-error-B6hORAwq.js";import{B as b}from"./app-logo-icon-EE7Bar-n.js";import{C as M,a as K,b as O,c as Q}from"./card-INt60vkO.js";import{I as N}from"./input-DKxKIjRb.js";import{L as g}from"./label-DrSVOj0Z.js";import{S as G,a as J,b as Y,d as U,e as W,f as X,g as Z}from"./select-D00R33EY.js";import{S as ee}from"./spinner-BYhoPCcg.js";import{A as te,s as se}from"./app-layout-BkLlokMk.js";import{A as ae}from"./arrow-left-DBk0y_wK.js";import{P as re}from"./plus-D6gLPwqQ.js";import{T as le}from"./trash-2-CaVI-rYo.js";import{S as ie}from"./save-BNCdT5vw.js";import{z as oe}from"./transition-BeoO98op.js";/* empty css            */import"./index-C4J_hXM0.js";import"./index-BfCENoI7.js";import"./index-C8eT4Gq4.js";import"./index-DGPL-D6u.js";import"./check-D_L4nmpS.js";import"./loader-circle-C0YtsFLV.js";const ne=[{title:"Edit Belanja",href:se.edit(1).url}],R=e=>e==null||e===""?"":Math.floor(Number(e)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,"."),me=e=>{if(typeof e=="number")return e;const s=e.replace(/\D/g,"");return s?parseInt(s,10):0};function ze(){const e=z.c(37),{list:s,stores:I,products:d}=$().props,{flash:F}=$().props;let p;e[0]!==s.items?(p=s.items.map(ge),e[0]=s.items,e[1]=p):p=e[1];let w;e[2]!==p?(w={items:p},e[2]=p,e[3]=w):w=e[3];const{data:a,setData:m}=P(w);let v;e[4]!==a.items||e[5]!==m?(v=()=>{m("items",[...a.items,{product_id:null,product_name:"",quantity:1,price:0}])},e[4]=a.items,e[5]=m,e[6]=v):v=e[6];const E=v;let y;e[7]!==a.items||e[8]!==m?(y=i=>{const o=a.items[i];if(o.is_bought&&!window.confirm(`Barang "${o.product_name}" sudah diceklis/dibeli. Yakin ingin menghapusnya?`))return;const c=[...a.items];c.splice(i,1),m("items",c)},e[7]=a.items,e[8]=m,e[9]=y):y=e[9];const L=y;let k;e[10]!==a.items||e[11]!==d||e[12]!==m?(k=(i,o,c)=>{const l=[...a.items];if(o==="price"?l[i][o]=me(c):o==="quantity"?l[i][o]=parseInt(c)||0:l[i][o]=c,o==="product_name"){const n=d.find(r=>r.name.toLowerCase()===c.toLowerCase());if(n){l[i].price=n.last_price||0,l[i].product_id=n.id;const r=document.getElementsByName(`items.${i}.price`)[0];r&&(r.value=R(n.last_price))}else l[i].product_id=null}m("items",l)},e[10]=a.items,e[11]=d,e[12]=m,e[13]=k):k=e[13];const x=k;let _;e[14]!==a.items?(_=a.items.reduce(he,0),e[14]=a.items,e[15]=_):_=e[15];const S=_;let C;e[16]===Symbol.for("react.memo_cache_sentinel")?(C=t.jsx(A,{title:"Daftar Belanja"}),e[16]=C):C=e[16];let q;e[17]===Symbol.for("react.memo_cache_sentinel")?(q=t.jsx("div",{className:"flex justify-end",children:t.jsxs(b,{variant:"ghost",className:"cursor-pointer flex items-center mb-2",onClick:ue,children:[t.jsx(ae,{className:"w-4 h-4"}),"Kembali"]})}),e[17]=q):q=e[17];let T;e[18]===Symbol.for("react.memo_cache_sentinel")?(T=t.jsx(O,{children:t.jsx(Q,{children:"Edit Daftar Belanja"})}),e[18]=T):T=e[18];let u;e[19]!==s.id?(u=H.update.form(s.id),e[19]=s.id,e[20]=u):u=e[20];let B;e[21]===Symbol.for("react.memo_cache_sentinel")?(B={preserveScroll:!0},e[21]=B):B=e[21];let h;e[22]!==E||e[23]!==a.items||e[24]!==F.message||e[25]!==s.shopping_date||e[26]!==s.store_id||e[27]!==s.title||e[28]!==d||e[29]!==L||e[30]!==I||e[31]!==S||e[32]!==x?(h=i=>{const{processing:o,recentlySuccessful:c,errors:l}=i;return t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[t.jsxs("div",{className:"grid gap-2",children:[t.jsx(g,{htmlFor:"store",children:"Pilih Toko"}),t.jsxs(G,{name:"store_id",defaultValue:s.store_id.toString(),required:!0,children:[t.jsx(J,{className:"w-full",children:t.jsx(Y,{placeholder:"Pilih Toko"})}),t.jsx(U,{children:t.jsxs(W,{children:[t.jsx(X,{children:"Daftar Toko Kamu"}),I.map(pe)]})})]}),t.jsx(j,{message:l.store_id})]}),t.jsxs("div",{className:"grid gap-2",children:[t.jsx(g,{htmlFor:"title",children:"Judul Belanja"}),t.jsx(N,{id:"title",name:"title",defaultValue:s.title,className:"mt-1 block w-full",placeholder:"Contoh: Belanja Bulanan MeowMeal.id",required:!0}),t.jsx(j,{message:l.title})]}),t.jsxs("div",{className:"grid gap-2",children:[t.jsx(g,{htmlFor:"tanggal",children:"Tanggal"}),t.jsx(N,{id:"tanggal",type:"datetime-local",name:"shopping_date",defaultValue:s.shopping_date?new Date(new Date(s.shopping_date).getTime()-new Date().getTimezoneOffset()*6e4).toISOString().slice(0,16):"",className:"mt-1 block w-full",required:!0}),t.jsx(j,{message:l.shopping_date})]})]}),t.jsx("hr",{}),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex justify-between items-center border-b pb-2",children:[t.jsx("h3",{className:"font-bold text-lg text-slate-800 dark:text-slate-50",children:"Daftar Barang"}),t.jsxs(b,{type:"button",variant:"outline",size:"sm",onClick:E,className:"cursor-pointer border-green-600 text-green-600 hover:bg-green-50 dark:hover:bg-green-800",children:[t.jsx(re,{className:"w-4 h-4"}),"Tambah"]})]}),t.jsx("div",{className:"space-y-6 md:space-y-2",children:a.items.map((n,r)=>t.jsxs("div",{className:"relative transition-all border-b md:border-b-0 pb-4 md:pb-0",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 items-start md:items-center",children:[t.jsxs("div",{className:"md:col-span-6",children:[t.jsx(g,{className:"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 md:hidden",children:"Nama Barang"}),t.jsx(N,{list:"product-suggestions",className:n.is_bought?"text-slate-400 dark:text-slate-600 bg-white md:mt-0 dark:bg-slate-800 line-through":"bg-white md:mt-0 dark:bg-slate-800",name:`items.${r}.product_name`,defaultValue:n.product_name,onChange:f=>x(r,"product_name",f.target.value),placeholder:"Nama barang...",required:!0,autoComplete:"off"})]}),t.jsxs("div",{className:"md:col-span-6 grid grid-cols-12 gap-3 items-center",children:[t.jsxs("div",{className:"col-span-4 md:col-span-3",children:[t.jsx(g,{className:"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 md:hidden",children:"Qty"}),t.jsx(N,{type:"number",className:n.is_bought?"text-slate-400 dark:text-slate-600 bg-white md:mt-0 dark:bg-slate-800 line-through text-center":"bg-white md:mt-0 dark:bg-slate-800 text-center",name:`items.${r}.quantity`,defaultValue:n.quantity,onChange:f=>x(r,"quantity",f.target.value),placeholder:"Qty",required:!0})]}),t.jsxs("div",{className:"col-span-8 md:col-span-7",children:[t.jsx(g,{className:"text-[10px] uppercase font-bold text-slate-500 dark:text-slate-400 md:hidden",children:"Harga"}),t.jsxs("div",{className:"relative mt-1 md:mt-0",children:[t.jsx("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-400 text-xs dark:text-slate-300",children:"Rp"}),t.jsx(N,{className:n.is_bought?"pl-8 font-medium text-slate-400 dark:text-slate-600 bg-white md:mt-0 dark:bg-slate-800 line-through":"pl-8 font-medium bg-white md:mt-0 dark:bg-slate-800",name:`items.${r}.price`,value:R(n.price),onChange:f=>x(r,"price",f.target.value),placeholder:"100.000",required:!0})]})]}),t.jsx("div",{className:"absolute -top-3 -right-3 md:relative md:top-0 md:right-0 md:col-span-2 flex justify-end",children:a.items.length>1&&t.jsx(b,{type:"button",variant:"ghost",size:"icon",onClick:()=>L(r),className:"h-8 w-8 rounded-full bg-red-100 text-red-600 md:bg-transparent md:text-slate-400 md:hover:text-red-600 md:hover:bg-red-50 cursor-pointer transition-colors dark:hover:bg-red-800 dark:hover:text-red-400",children:t.jsx(le,{className:"w-4 h-4"})})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4",children:[t.jsx("div",{className:"md:col-span-6",children:t.jsx(j,{message:l[`items.${r}.product_name`]})}),t.jsx("div",{className:"md:col-span-6",children:t.jsx(j,{message:l[`items.${r}.price`]})})]})]},r))}),t.jsx("datalist",{id:"product-suggestions",children:d.map(de)})]}),t.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 pt-4 border-t",children:[t.jsxs("div",{className:"text-xl md:text-2xl font-bold tracking-tight text-green-600 w-full md:w-auto text-center md:text-left",children:["Total : Rp ",S?R(S):"-"]}),t.jsxs("div",{className:"flex flex-col-reverse sm:flex-row gap-2 items-center w-full md:w-auto",children:[t.jsx(oe,{show:c,enter:"transition ease-in-out",enterFrom:"opacity-0",leave:"transition ease-in-out",leaveTo:"opacity-0",children:t.jsx("p",{className:"text-sm text-neutral-600 dark:text-neutral-400",children:F.message||"Tersimpan"})}),t.jsx(b,{type:"button",variant:"ghost",className:"cursor-pointer w-full sm:w-auto order-2 sm:order-1",onClick:ce,children:"Kembali"}),t.jsx(b,{type:"submit",disabled:o,className:"bg-green-600 hover:bg-green-700 cursor-pointer w-full sm:w-auto order-1 sm:order-2 py-6 md:py-2 text-lg md:text-sm",children:o?t.jsxs(t.Fragment,{children:[t.jsx(ee,{className:"h-4 w-4 animate-spin"}),"Memproses..."]}):t.jsxs(t.Fragment,{children:[t.jsx(ie,{className:"w-4 h-4"}),"Simpan Data"]})})]})]})]})},e[22]=E,e[23]=a.items,e[24]=F.message,e[25]=s.shopping_date,e[26]=s.store_id,e[27]=s.title,e[28]=d,e[29]=L,e[30]=I,e[31]=S,e[32]=x,e[33]=h):h=e[33];let D;return e[34]!==h||e[35]!==u?(D=t.jsxs(te,{breadcrumbs:ne,children:[C,t.jsxs("div",{className:"flex h-full flex-1 flex-col gap-4 overflow-x-auto rounded-xl p-4",children:[q,t.jsxs(M,{children:[T,t.jsx(K,{children:t.jsx(V,{...u,options:B,className:"space-y-6",children:h})})]})]})]}),e[34]=h,e[35]=u,e[36]=D):D=e[36],D}function ce(){return window.history.back()}function de(e){return t.jsx("option",{value:e.name},e.id)}function pe(e){return t.jsx(Z,{value:e.id.toString(),children:t.jsx("span",{className:"capitalize",children:e.name})},e.id)}function ue(){return window.history.back()}function he(e,s){return e+s.quantity*s.price}function ge(e){return{product_id:e.product_id,product_name:e.product_name_snapshot,quantity:e.quantity,price:e.price_per_unit,is_bought:e.is_bought}}export{ze as default};
